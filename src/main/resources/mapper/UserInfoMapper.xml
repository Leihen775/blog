<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="blog.home.dao.UserInfoMapper">

  <!-- 添加用户信息 -->
  <insert id="addUser" parameterType="blog.home.model.UserInfo">
    INSERT INTO user_core (accountnum,username,password,realname,job,sex,birth,trade_id,address,email,
    summary,image_path,birth_private,realname_private,address_private,attentioncount,fanscount,
    articlecount,commentcount,praisecount) 
    VALUE(#{accountNum},#{username},#{password},#{realname},#{job},#{sex},#{birth},#{trade_id},#{address},
    #{email},#{summary},#{image_path},#{birth_private},#{realname_private},#{address_private},
    #{attentionCount},#{fansCount},#{articleCount},#{commentCount},#{praiseCount})
  </insert>
  
  <!-- 修改用户信息 -->
  <update id="updateUser" parameterType="blog.home.model.UserInfo">
    UPDATE user_core
    <set>
      <include refid="UPDATE_USER_SET"></include>
    </set>
    WHERE id=#{id}
  </update>
  
  <!-- 修改用户行业信息(当用户行业被单个删除时使用) -->
  <update id="updateUserTrade" parameterType="int">
    UPDATE user_core SET trade_id=null WHERE trade_id=#{tid}
  </update>
  
  <!-- 修改用户行业信息(当用户行业被批量删除时使用) -->
  <update id="updateUserTradeBatch" parameterType="java.util.List">
    UPDATE user_core SET trade_id=null WHERE
    <foreach collection="list" item="tid" separator="or">
      trade_id=#{tid}
    </foreach>
  </update>
  
  <!-- 根据Id查询用户信息 -->
  <select id="findUser" parameterType="int" resultMap="userResult">
    SELECT a.*,b.id trade_id,b.name
    FROM (user_info a)
    LEFT JOIN user_trade b ON a.trade_id = b.id
    WHERE id=#{id}
  </select>
  
  <!-- 根据账号或用户名查找用户简单信息 -->
  <select id="findUserByAccount" parameterType="String" resultType="blog.home.model.UserInfo">
    SELECT a.id,a.accountnum,a.username,a.password
    FROM user_info a 
    WHERE accountnum=#{accountNum} OR username=#{info}
  </select>
  
  <sql id="UPDATE_USER_SET">
    <if test="accountNum!=null and accountNum!=''">accountnum=#{accountNum}</if>
    <if test="username!=null and username!=''">username=#{username}</if>
    <if test="password!=null and password!=''">password=#{password}</if>
    <if test="realname!=null and realname!=''">realname=#{realname}</if>
    <if test="job!=null and job!=''">job=#{job}</if>
    <if test="sex!=null and sex!=''">sex=#{sex}</if>
    <if test="birth!=null and birth!=''">birth=#{birth}</if>
    <if test="trade_id!=null and trade_id!=''">trade_id=#{trade_id}</if>
    <if test="address!=null and address!=''">address=#{address}</if>
    <if test="email!=null and email!=''">email=#{email}</if>
    <if test="summary!=null and summary!=''">summary=#{summary}</if>
    <if test="image_path!=null and image_path!=''">image_path=#{image_path}</if>
    <if test="birth_private!=null and birth_private!=''">birth_private=#{birth_private}</if>
    <if test="realname_private!=null and realname_private!=''">realname_private=#{realname_private}</if>
    <if test="address_private!=null and address_private!=''">address_private=#{address_private}</if>
    <if test="attentionCount!=null and attentionCount!=''">attentioncount=#{attentionCount}</if>
    <if test="fansCount!=null and fansCount!=''">fanscount=#{fansCount}</if>
    <if test="articleCount!=null and articleCount!=''">articlecount=#{articleCount}</if>
    <if test="commentCount!=null and commentCount!=''">commentcount=#{commentCount}</if>
    <if test="praiseCount!=null and praiseCount!=''">praisecount=#{praiseCount}</if>
  </sql>
  
  <resultMap type="blog.home.model.UserInfo" id="userResult">
      <result column="id" property="id"/>
      <result column="accountnum" property="accountNum"/>
      <result column="username" property="username"/>
      <result column="password" property="password"/>
      <result column="realname" property="realname"/>
      <result column="job" property="job"/>
      <result column="sex" property="sex"/>
      <result column="birth" property="birth"/>
      <result column="address" property="address"/>
      <result column="email" property="email"/>
      <result column="summary" property="summary"/>
      <result column="image_path" property="image_path"/>
      <result column="birth_private" property="birth_private"/>
      <result column="realname_private" property="realname_private"/>
      <result column="address_private" property="address_private"/>
      <result column="attentioncount" property="attentionCount"/>
      <result column="fanscount" property="fansCount"/>
      <result column="articlecount" property="articleCount"/>
      <result column="commentcount" property="commentCount"/>
      <result column="praisecount" property="praiseCount"/>
    <association property="trade" javaType="blog.home.model.Trade">
      <result column="trade_id" property="id"/>
      <result column="name" property="name"/>
    </association>
  </resultMap>
  
</mapper>